function processDrawioFile(fileContent) {
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(fileContent, 'text/xml');

    const tasks = []; // Store tasks with their connections
    const connections = []; // Store all connections as { source, text }

    // Extract connections (lines) from the diagram
    xmlDoc.querySelectorAll('mxCell[edge="1"]').forEach(cell => {
        const source = cell.getAttribute('source');
        const lineText = cell.getAttribute('value') || 'No text associated with this line';

        if (source) {
            connections.push({ source, text: lineText.trim() });
        }
    });

    // Extract tasks and associate their connections
    xmlDoc.querySelectorAll('mxCell[style*="rounded=1"]').forEach(cell => {
        const rawValue = cell.getAttribute('value') || 'Unnamed Task';
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = rawValue;
        const taskName = tempDiv.textContent.trim(); // Extract plain text

        const taskId = cell.getAttribute('id');
        const taskConnections = connections
            .filter(connection => connection.source === taskId)
            .map(connection => connection.text);

        tasks.push({ id: taskId, name: taskName, connections: taskConnections });
    });

    renderTasks(tasks);
}

function renderTasks(tasks) {
    const taskContainer = document.getElementById('taskContainer');
    const tasksDiv = document.getElementById('tasks');
    tasksDiv.innerHTML = '';

    tasks.forEach(task => {
        const taskRow = document.createElement('div');
        taskRow.className = 'task-row mb-3';

        const taskLabel = document.createElement('label');
        taskLabel.className = 'form-label';
        taskLabel.innerText = `Task: ${task.name} (ID: ${task.id})`;
        taskRow.appendChild(taskLabel);

        if (task.connections.length > 0) {
            const connectionList = document.createElement('ul');
            task.connections.forEach(connection => {
                const listItem = document.createElement('li');
                listItem.innerText = connection;
                connectionList.appendChild(listItem);
            });
            taskRow.appendChild(connectionList);
        } else {
            const noConnectionMessage = document.createElement('p');
            noConnectionMessage.innerText = 'No connections associated with this task.';
            noConnectionMessage.className = 'text-muted';
            taskRow.appendChild(noConnectionMessage);
        }

        tasksDiv.appendChild(taskRow);
    });

    taskContainer.classList.remove('d-none');
}
