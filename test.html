<script>
const displayData = JSON.parse(localStorage.getItem('displayData')) || [];
const insertsData = JSON.parse(localStorage.getItem('insertsData')) || {};

function renderWorkflow() {
    const container = document.getElementById('workflowContainer');
    container.innerHTML = ''; // Clear existing content

    // Iterate through workflows
    displayData.forEach(workflow => {
        const workflowDiv = document.createElement('div');
        workflowDiv.innerHTML = `<h3>${workflow.title}</h3>`;
        container.appendChild(workflowDiv);

        workflow.tasks.forEach(task => {
            // Create task and dropdown
            const taskDiv = document.createElement('div');
            taskDiv.innerHTML = `<p>${task.name}</p>`;
            const dropdown = createDropdown(task, workflow.workflowId);
            taskDiv.appendChild(dropdown);
            workflowDiv.appendChild(taskDiv);
        });
    });
}

function createDropdown(task, workflowId) {
    const dropdown = document.createElement('select');
    dropdown.innerHTML = `<option>Select a result</option>`;

    task.results.forEach(result => {
        const option = document.createElement('option');
        option.value = result.result;
        option.textContent = result.result;
        dropdown.appendChild(option);
    });

    dropdown.addEventListener('change', event => {
        const selectedResult = event.target.value;
        const taskKey = `${workflowId}-${task.id}-${selectedResult}`;
        const insert = insertsData[taskKey];

        if (insert) {
            if (insert.startsWith('Sub Workflow')) {
                insertSubWorkflow(insert);
            } else {
                insertTask(insert);
            }
        }
    });

    return dropdown;
}

function insertSubWorkflow(subWorkflowName) {
    const subWorkflow = displayData.find(workflow => workflow.title === subWorkflowName);
    if (subWorkflow) {
        // Add tasks from the subworkflow
        subWorkflow.tasks.forEach(task => {
            console.log(`Inserting task: ${task.name}`);
        });
    }
}

function insertTask(taskName) {
    console.log(`Inserting task: ${taskName}`);
}

renderWorkflow();
</script>
